<!DOCTYPE html>
<html>
	<head>
		<title>Mazer</title>
		<link rel="stylesheet" href="css/style.css">
		<script src="js/graphics.js"></script>
	</head>
	<body>
		<div id="visualization" class="horizontal-section">
			<div id="canvas-container">
				<canvas width="490" height="490" id="canvas"></canvas>	
			</div>
			<div class="top-margin">
				<button onclick="renderer.toggleGrid()">Toggle Grid</button>
				<button onclick="main()">Regenerate</button>
			</div>
			<div class="top-margin" id="controls">
				<div class="input-group">
					<label for="minRoomWidth">Min Room Width: <span id="roomMinWidthValue">3</span></label>
					<input type="range" min="3" max="11" step="2" value="3" id="minRoomWidth" name="minRoomWidth">
				</div>
				<div class="input-group">
					<label for="minRoomHeight">Min Room Height: <span id="roomMinHeightValue">3</span></label>
					<input type="range" min="3" max="11" step="2" value="3" id="minRoomHeight" name="minRoomHeight">
				</div>
				<div class="input-group">
					<label for="maxRoomWidth">Max Room Width: <span id="roomMaxWidthValue">11</span></label>
					<input type="range" min="5" max="15" step="2" value="11" id="maxRoomWidth" name="maxRoomWidth">
				</div>
				<div class="input-group">
					<label for="maxRoomHeight">Max Room Height: <span id="roomMaxHeightValue">11</span></label>
					<input type="range" min="5" max="15" step="2" value="11" id="maxRoomHeight" name="maxRoomHeight">
				</div>
				<div class="input-group">
					<label for="maxRoomDoors">Max Room Doors: <span id="maxRoomDoorsSpan">3</span></label>
					<input type="range" min="1" max="5" step="1" value="3" id="maxDoors" name="maxDoors">
				</div>
				<div class="input-group">
					<label for="maxSparseness">Max Sparseness: <span id="maxSparsenessSpan">150</span></label>
					<input type="range" min="50" max="200" step="5" value="150" id="maxSparseness" name="maxSparseness">
				</div>
			</div>
		</div>
		<div id="textOutput" class="horizontal-section scrollable">
			
		</div>
		<script src="js/linguistics.js"></script>
		<script src="js/factions.js"></script>
		<script src="js/utils.js"></script>
		<script src="js/mapLogic.js"></script>
		
		<script>
			var canvas = document.getElementById('canvas');
			var ctx = canvas.getContext('2d');

			var dungeonMap = new DungeonMap(canvas.height, canvas.width)
			
			//Slider Setup
			var minRoomHeightSlider = document.getElementById('minRoomHeight')
			var maxRoomHeightSlider = document.getElementById('maxRoomHeight')
			var minRoomWidthSlider = document.getElementById('minRoomWidth')
			var maxRoomWidthSlider = document.getElementById('maxRoomWidth')
			var maxDoorSlider = document.getElementById('maxDoors')
			var maxSparsenessSlider = document.getElementById('maxSparseness')

			var minRoomWidthSpanElement = document.getElementById('roomMinWidthValue')
			var maxRoomWidthSpanElement = document.getElementById('roomMaxWidthValue')
			var minRoomHeightSpanElement = document.getElementById('roomMinHeightValue')
			var maxRoomHeightSpanElement = document.getElementById('roomMaxHeightValue')
			var maxDoorSpan = document.getElementById('maxRoomDoorsSpan')
			var maxSparsenessSpan = document.getElementById('maxSparsenessSpan')

			minRoomHeightSlider.oninput = function(){
				minRoomHeightSpanElement.innerHTML = this.value
				dungeonMap.minRoomHeight = parseInt(this.value)
			}

			maxRoomHeightSlider.oninput = function(){
				maxRoomHeightSpanElement.innerHTML = this.value
				dungeonMap.maxRoomHeight = parseInt(this.value)
			}

			minRoomWidthSlider.oninput = function(){
				minRoomWidthSpanElement.innerHTML = this.value
				dungeonMap.minRoomWidth = parseInt(this.value)
			}

			maxRoomWidthSlider.oninput = function(){
				maxRoomWidthSpanElement.innerHTML = this.value
				dungeonMap.maxRoomWidth = parseInt(this.value)
			}

			maxDoorSlider.oninput = function(){
				maxDoorSpan.innerHTML = this.value
				dungeonMap.maxRoomDoors = parseInt(this.value)
			}

			maxSparsenessSlider.oninput = function(){
				maxSparsenessSpan.innerHTML = this.value
				dungeonMap.maxSparseness = parseInt(this.value)
			}

			var map = []
			
			//The main map creation function
			function main(){
				//Initialize the map
				map = []
				dungeonMap.room_array = []

				//Clear the Canvas
				renderer.clear_canvas()

				// Initialize an empty map
				for (var i = 0; i < dungeonMap.total_y_cells; i++){
					map.push([])
					for (var j = 0; j < dungeonMap.total_x_cells; j++){
						map[i].push(0);
					}
				}

				// Establish the rooms
				dungeonMap.establish_rooms()
				let finished = false;

				// Start creating the corridors
				var current_cell = dungeonMap.pickStart();
				while(!finished){
					dungeonMap.make_corridors(current_cell)
					current_cell = dungeonMap.scan_for_new_seeds()
					if (current_cell == null){
						finished = true;
					}
				}

				//Scan for room to corridor connections
				for (let y = 1; y < map.length-1 ; y++){
					for (let x = 1; x < map[0].length-1; x++){
						if (map[y][x] != dungeonMap.CONSTANTS.WALL_TILE){
							continue;
						}
						valid_connection = dungeonMap.get_valid_wall_teardown(x,y)
					}
				}

				dungeonMap.add_room_doors()
			}

			main()


		</script>
	</body>
</html>