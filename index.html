<html>
	<head>
		<title>Mazer</title>
		<link rel="stylesheet" href="css/style.css">
		
	</head>
	<body>
		<canvas width="500" height="500" id="canvas"></canvas>
		<div class="top-margin">
			<button onclick="toggleGrid()">Toggle Grid</button>
		</div>
		<script src="js/rooms.js"></script>
		<script src="js/grid.js"></script>
		<script>
			var canvas = document.getElementById('canvas');
			var ctx = canvas.getContext('2d');
			var map = [];
			var grid = false;

			//Convert pixels into cell dimensions
			var cell_x = 10;
			var cell_y = 10;
			var total_y_cells = Math.floor(canvas.height / cell_y);
			var total_x_cells = Math.floor(canvas.width / cell_x);

			//Room stuff
			var min_room = 4;
			var max_room = 10;
			var attempts = 50;
			var room_array = [];

			//Helpers
			function randomIntFromInterval(min,max){
				return Math.floor(Math.random()*(max-min+1)+min);
			}


			//Prim's Algorithm Functions
			function pushNeighboursToFrontier(cell){
				//TODO
			}

			function pickFromFrontier(){
				//TODO
			}

			function pickStart(){
				var x;
				var y;
				var not_placeable = true;
				while (not_placeable){
					x = randomIntFromInterval(1, total_x_cells-1);
					y = randomIntFromInterval(1, total_y_cells-1);
					if (map[y][x] === 0){
						not_placeable = false;
					}
				}
				map[y][x] = 2;
				return {x:x, y:y};
			}

			//Graphics
			function paintCorridor(cell){
				ctx.strokeStyle = '#33AA33';
				ctx.strokeRect(cell.x*cell_x,cell.y*cell_y,cell_x,cell_y);
			}
			function paintFrontier(cell){
				ctx.strokeStyle = '#3333AA';
				ctx.strokeRect(cell.x*cell_x,cell.y*cell_y,cell_x,cell_y);
			}

			for (var i = 0; i < total_y_cells; i++){
				map.push([])
				for (var j = 0; j < total_x_cells; j++){
					map[i].push(0);
				}
			}

			var room;
			var collision;
			for (var i = 0; i < attempts; i++){
				collision = false;
				room = createRoom(min_room,max_room);
				for (var j = 0; j < room_array.length; j++){
					if(detectRoomCollision(room, room_array[j])){
						collision = true;
						break;
					}
				}
				if (!collision){
					mapRoom(room);
					room_array.push(room);
				}
			}

			for (var i = 0; i < room_array.length; i++){
				paintRoom(room_array[i]);
			}

			var current_cell = pickStart();
			paintCorridor(current_cell);

			//paintGrid();
		</script>
	</body>
</html>