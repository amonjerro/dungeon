<!DOCTYPE html>
<html>
	<head>
		<title>Mazer</title>
		<link rel="stylesheet" href="css/style.css">
		
	</head>
	<body>
		<canvas width="500" height="500" id="canvas"></canvas>
		<div class="top-margin">
			<button onclick="toggleGrid()">Toggle Grid</button>
		</div>
		<script src="js/utils.js"></script>
		<script src="js/structures.js"></script>
		<script src="js/grid.js"></script>
		<script src="js/graphics.js"></script>
		<script>
			var canvas = document.getElementById('canvas');
			var ctx = canvas.getContext('2d');
			var map = [];
			var grid = false;

			//Room stuff
			var min_room = 4;
			var max_room = 10;
			var attempts = 200;
			var room_array = [];

			function pickStart(){
				var x;
				var y;
				var not_placeable = true;
				while (not_placeable){
					x = randomOddIntFromInterval(1, total_x_cells-1);
					y = randomOddIntFromInterval(1, total_y_cells-1);
					if (map[y][x] === 0){
						not_placeable = false;
					}
				}
				map[y][x] = 2;
				return {x:x, y:y};
			}

			function scanForNewSeeds(){
				let seed = null
				for(let y = 1; y < total_y_cells-1; y += 2){
					let found = false;
					for (let x = 1; x < total_x_cells-1; x += 2){
						if (map[y][x] != 0){
							continue;
						}
						let horizon = get_valid_cell_neighbors({x:x, y:y})
						if (horizon.length > 0){
							found = true;
							seed = {x:x, y:y}
							console.log(seed, horizon)
							break;
						}
					}
					if (found){
						break;
					}
				}
				
				return seed
			}
			

			// Initialize an empty map
			for (var i = 0; i < total_y_cells; i++){
				map.push([])
				for (var j = 0; j < total_x_cells; j++){
					map[i].push(0);
				}
			}

			function main(){
				// Establish the rooms
				establish_rooms()

				// Paint the rooms
				for (var i = 0; i < room_array.length; i++){
					paintRoom(room_array[i]);
				}

				let finished = false;

				// Start creating the corridors
				var current_cell = pickStart();
				while(!finished){
					make_corridors(current_cell)
					current_cell = scanForNewSeeds()
					if (current_cell == null){
						finished = true;
					}
				}

			}

			main()
		</script>
	</body>
</html>