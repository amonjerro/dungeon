<!DOCTYPE html>
<html>
	<head>
		<title>Mazer</title>
		<link rel="stylesheet" href="css/style.css">
		
	</head>
	<body>
		<div id="visualization" class="horizontal-section">
			<div id="canvas-container">
				<canvas width="490" height="490" id="canvas"></canvas>	
			</div>
			<div class="top-margin">
				<button onclick="toggleGrid()">Toggle Grid</button>
				<button onclick="main()">Regenerate</button>
			</div>
			<div class="top-margin" id="controls">
				<div class="input-group">
					<label for="minRoomWidth">Min Room Width: <span id="roomMinWidthValue">3</span></label>
					<input type="range" min="3" max="11" step="2" value="3" id="minRoomWidth" name="minRoomWidth">
				</div>
				<div class="input-group">
					<label for="minRoomHeight">Min Room Height: <span id="roomMinHeightValue">3</span></label>
					<input type="range" min="3" max="11" step="2" value="3" id="minRoomHeight" name="minRoomHeight">
				</div>
				<div class="input-group">
					<label for="maxRoomWidth">Max Room Width: <span id="roomMaxWidthValue">11</span></label>
					<input type="range" min="5" max="15" step="2" value="11" id="maxRoomWidth" name="maxRoomWidth">
				</div>
				<div class="input-group">
					<label for="maxRoomHeight">Max Room Height: <span id="roomMaxHeightValue">11</span></label>
					<input type="range" min="5" max="15" step="2" value="11" id="maxRoomHeight" name="maxRoomHeight">
				</div>
				<div class="input-group">
					<label for="maxRoomDoors">Max Room Doors: <span id="maxRoomDoorsSpan">3</span></label>
					<input type="range" min="1" max="5" step="2" value="11" id="maxDoors" name="maxDoors">
				</div>
			</div>
		</div>
		<div id="textOutput" class="horizontal-section scrollable">
			
		</div>
		<script src="js/utils.js"></script>
		<script src="js/mapLogic.js"></script>
		<script src="js/grid.js"></script>
		<script src="js/graphics.js"></script>
		<script>
			var canvas = document.getElementById('canvas');
			var ctx = canvas.getContext('2d');
			
			//Slider Setup
			var minRoomHeightSlider = document.getElementById('minRoomHeight')
			var maxRoomHeightSlider = document.getElementById('maxRoomHeight')
			var minRoomWidthSlider = document.getElementById('minRoomWidth')
			var maxRoomWidthSlider = document.getElementById('maxRoomWidth')
			var maxDoorSlider = document.getElementById('maxDoors')

			var minRoomWidthSpanElement = document.getElementById('roomMinWidthValue')
			var maxRoomWidthSpanElement = document.getElementById('roomMaxWidthValue')
			var minRoomHeightSpanElement = document.getElementById('roomMinHeightValue')
			var maxRoomHeightSpanElement = document.getElementById('roomMaxHeightValue')
			var maxDoorSpan = document.getElementById('maxRoomDoorsSpan')

			minRoomHeightSlider.oninput = function(){
				minRoomHeightSpanElement.innerHTML = this.value
				min_room_height = parseInt(this.value)
			}

			maxRoomHeightSlider.oninput = function(){
				maxRoomHeightSpanElement.innerHTML = this.value
				max_room_height = parseInt(this.value)
			}

			minRoomWidthSlider.oninput = function(){
				minRoomWidthSpanElement.innerHTML = this.value
				min_room_width = parseInt(this.value)
			}

			maxRoomWidthSlider.oninput = function(){
				maxRoomWidthSpanElement.innerHTML = this.value
				max_room_width = parseInt(this.value)
			}

			maxDoorSlider.oninput = function(){
				maxDoorSpan.innerHTML = this.value
				max_room_doors = parseInt(this.value)
			}

			var map = [];
			var grid = false
			
			//The main map creation function
			function main(){
				//Initialize the map
				map = []
				room_array = []

				//Clear the Canvas
				clearCanvas()

				// Initialize an empty map
				for (var i = 0; i < total_y_cells; i++){
					map.push([])
					for (var j = 0; j < total_x_cells; j++){
						map[i].push(0);
					}
				}

				// Establish the rooms
				establish_rooms()

				// Paint the rooms
				for (var i = 0; i < room_array.length; i++){
					paintRoom(room_array[i]);
				}

				let finished = false;

				// Start creating the corridors
				var current_cell = pickStart();
				while(!finished){
					make_corridors(current_cell)
					current_cell = scanForNewSeeds()
					if (current_cell == null){
						finished = true;
					}
				}

				//Scan for room to corridor connections
				for (let y = 1; y < map.length-1 ; y++){
					for (let x = 1; x < map[0].length-1; x++){
						if (map[y][x] != 0){
							continue;
						}
						valid_connection = get_valid_wall_teardown(x,y)
						if (valid_connection){
							paintValidWallTeardown(x,y)
						}
					}
				}
				addRoomDoors()
			}

			main()


		</script>
	</body>
</html>